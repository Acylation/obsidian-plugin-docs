"use strict";(self.webpackChunkobsidian_plugin_docs=self.webpackChunkobsidian_plugin_docs||[]).push([[4485],{3253:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>r,contentTitle:()=>o,default:()=>c,frontMatter:()=>s,metadata:()=>l,toc:()=>d});var a=n(7462),i=(n(7294),n(3905));n(1839);const s={sidebar_position:2},o="State fields",l={unversionedId:"editor/extensions/state-fields",id:"editor/extensions/state-fields",title:"State fields",description:"A state field is an editor extension that lets you manage custom editor state. This page walks you through building a state field by implementing a calculator extension.",source:"@site/docs/editor/extensions/state-fields.md",sourceDirName:"editor/extensions",slug:"/editor/extensions/state-fields",permalink:"/obsidian-plugin-docs/editor/extensions/state-fields",draft:!1,editUrl:"https://github.com/marcusolsson/obsidian-plugin-docs/edit/main/docs/editor/extensions/state-fields.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"docs",previous:{title:"State management",permalink:"/obsidian-plugin-docs/editor/extensions/state-management"},next:{title:"Viewport",permalink:"/obsidian-plugin-docs/editor/extensions/viewport"}},r={},d=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Defining state effects",id:"defining-state-effects",level:2},{value:"Defining a state field",id:"defining-a-state-field",level:2},{value:"Dispatching state effects",id:"dispatching-state-effects",level:2},{value:"Next steps",id:"next-steps",level:2}],f={toc:d};function c(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,a.Z)({},f,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"state-fields"},"State fields"),(0,i.kt)("p",null,"A state field is an ",(0,i.kt)("a",{parentName:"p",href:"/obsidian-plugin-docs/editor/extensions/"},"editor extension")," that lets you manage custom editor state. This page walks you through building a state field by implementing a calculator extension."),(0,i.kt)("p",null,"The calculator should be able to add and subtract a number from the current state, and to reset the state when you want to start over."),(0,i.kt)("p",null,"By the end of this page, you'll understand the basic concepts of building a state field."),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"This page aims to distill the official CodeMirror 6 documentation for Obsidian plugin developers. For more detailed information on state fields, refer to ",(0,i.kt)("a",{parentName:"p",href:"https://codemirror.net/docs/guide/#state-fields"},"State Fields"),".")),(0,i.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Basic understanding of ",(0,i.kt)("a",{parentName:"li",href:"/obsidian-plugin-docs/editor/extensions/state-management"},"State management"),".")),(0,i.kt)("h2",{id:"defining-state-effects"},"Defining state effects"),(0,i.kt)("p",null,"State effects describe the state change you'd like to make. You may think of them as methods on a class."),(0,i.kt)("p",null,"In the calculator example, you'd define a state effect for each of the calculator operations:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"const addEffect = StateEffect.define<number>();\nconst subtractEffect = StateEffect.define<number>();\nconst resetEffect = StateEffect.define();\n")),(0,i.kt)("p",null,"The type between the angle brackets, ",(0,i.kt)("inlineCode",{parentName:"p"},"<>"),", defines the input type for the effect. For example, the number you want to add or subtract. The reset effect doesn't need any input, so you can leave it out."),(0,i.kt)("h2",{id:"defining-a-state-field"},"Defining a state field"),(0,i.kt)("p",null,"Contrary to what one might think, state fields don't actually ",(0,i.kt)("em",{parentName:"p"},"store")," state. They ",(0,i.kt)("em",{parentName:"p"},"manage")," it. State fields take the current state, applies any state effects, and returns the new state."),(0,i.kt)("p",null,"The state field contains the calculator logic to apply the mathematical operations depending on the effects in a transaction. Since a transaction can contain multiple effects, for example two additions, the state field needs to apply them all one after another."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"export const calculatorField = StateField.define<number>({\n  create(state: EditorState): number {\n    return 0;\n  },\n  update(oldState: number, transaction: Transaction): number {\n    let newState = oldState;\n\n    for (let effect of transaction.effects) {\n      if (effect.is(addEffect)) {\n        newState += effect.value;\n      } else if (effect.is(subtractEffect)) {\n        newState -= effect.value;\n      } else if (effect.is(resetEffect)) {\n        newState = 0;\n      }\n    }\n\n    return newState;\n  },\n});\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"create")," returns the value the calculator starts with."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"update")," contains the logic for applying the effects."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"effect.is()")," lets you check the type of the effect before you apply it.")),(0,i.kt)("h2",{id:"dispatching-state-effects"},"Dispatching state effects"),(0,i.kt)("p",null,"To apply a state effect to a state field, you need to dispatch it to the editor view as part of a transaction."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"view.dispatch({\n  effects: [addEffect.of(num)],\n});\n")),(0,i.kt)("p",null,"You can even define a set of helper functions that provide a more familiar API:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts"},"export function add(view: EditorView, num: number) {\n  view.dispatch({\n    effects: [addEffect.of(num)],\n  });\n}\n\nexport function subtract(view: EditorView, num: number) {\n  view.dispatch({\n    effects: [subtractEffect.of(num)],\n  });\n}\n\nexport function reset(view: EditorView) {\n  view.dispatch({\n    effects: [resetEffect.of(null)],\n  });\n}\n")),(0,i.kt)("h2",{id:"next-steps"},"Next steps"),(0,i.kt)("p",null,"Provide ",(0,i.kt)("a",{parentName:"p",href:"/obsidian-plugin-docs/editor/extensions/decorations"},"Decorations")," from your state fields to change how to display the document."))}c.isMDXComponent=!0}}]);